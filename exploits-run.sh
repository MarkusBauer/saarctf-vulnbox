#!/usr/bin/env bash

SCRIPTPATH="$(cd "$(dirname "$BASH_SOURCE")" && pwd)"
cd "$SCRIPTPATH"

if [ $# -eq 0 ]; then
  echo "USAGE: $0 <target-ip>"
  exit 1
else
  TARGET=$1
  shift
fi

echo "Testing all service exploits against $TARGET ..."

for d in services/*/ ; do
  servicename=$(basename "$d")
  echo ""
  echo "=== Exploiting service '$servicename' ==="
  echo "(full log in /tmp/service-exploits-$servicename.log)"
  timeout 120 ${d}gamelib/run-exploits "$TARGET" "$@" 2>&1 | tee "/tmp/service-exploits-$servicename.log" | tail -7
done

echo ""
echo "[[DONE]]"
